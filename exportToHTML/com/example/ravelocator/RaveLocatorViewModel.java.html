<html>
<head>
<title>RaveLocatorViewModel.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RaveLocatorViewModel.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.example.ravelocator</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">android.Manifest</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.app.Application</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.content.SharedPreferences</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.util.Log</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.Toast</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">androidx.annotation.NonNull</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.lifecycle.AndroidViewModel</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.lifecycle.LiveData</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.lifecycle.MutableLiveData</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.preference.PreferenceManager</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.work.OneTimeWorkRequest</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.work.PeriodicWorkRequest</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.work.WorkManager</span><span class="s0">;</span>


<span class="s0">import </span><span class="s1">com.example.ravelocator.model.GetLocationId</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.model.LocationDataModel</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.workers.UpdateDatabaseWorker</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.model.Datum</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.model.DatumFavoriteUpdate</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.model.RaveLocatorModel</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.example.ravelocator.model.Venue</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">com.google.android.gms.location.FusedLocationProviderClient</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">java.text.SimpleDateFormat</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.Calendar</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.Date</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.List</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.concurrent.Executors</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.concurrent.TimeUnit</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">retrofit2.Call</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">retrofit2.Callback</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">retrofit2.Response</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">retrofit2.Retrofit</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">retrofit2.converter.jackson.JacksonConverterFactory</span><span class="s0">;</span>

<span class="s0">public class </span><span class="s1">RaveLocatorViewModel </span><span class="s0">extends </span><span class="s1">AndroidViewModel {</span>

    <span class="s0">private static final </span><span class="s1">String FINE_LOCATION = Manifest.permission.ACCESS_FINE_LOCATION</span><span class="s0">;</span>
    <span class="s0">private static final </span><span class="s1">String COURSE_LOCATION = Manifest.permission.ACCESS_COARSE_LOCATION</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">DatumDao datumDao</span><span class="s0">;</span>
    <span class="s0">private static final int </span><span class="s1">LOCATION_PERMISSION_REQUEST_CODE = </span><span class="s2">1234</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Boolean mLocationPermissionsGranted = </span><span class="s0">false;</span>
    <span class="s0">private </span><span class="s1">FusedLocationProviderClient mFusedLocationProviderClient</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String TAG = getClass().getSimpleName()</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">String day</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">List&lt;Datum&gt; searchResults</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">DatumVenueCrossRef crossRef</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">LiveData&lt;DatumWithVenue&gt; datumWithVenue</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">MutableLiveData&lt;RaveLocatorModel&gt; mutableLiveData = </span><span class="s0">new </span><span class="s1">MutableLiveData&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">WorkManager mWorkManager</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">FusedLocationProviderClient fusedLocationClient</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">String latitude</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">String longitude</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">SharedPreferences sharedPref</span><span class="s0">;</span>
    <span class="s0">private final boolean </span><span class="s1">includeElectronicGenreInd</span><span class="s0">;</span>
    <span class="s0">private final boolean </span><span class="s1">includeOtherGenreInd</span><span class="s0">;</span>
    <span class="s0">private final boolean </span><span class="s1">livestreamInd</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String state</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String city</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String lat</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String lon</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String startDate</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String endDate</span><span class="s0">;</span>
    <span class="s0">private int </span><span class="s1">locationId</span><span class="s0">;</span>
    <span class="s0">private final boolean </span><span class="s1">festivalInd</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">String today</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">MutableLiveData&lt;RaveLocatorModel&gt; nearbyEventsList</span><span class="s0">;</span>
    <span class="s0">public </span><span class="s1">RaveLocatorViewModel(@NonNull Application application) {</span>
        <span class="s0">super</span><span class="s1">(application)</span><span class="s0">;</span>
        <span class="s1">mRepository = </span><span class="s0">new </span><span class="s1">RaveLocatorRepository(application)</span><span class="s0">;</span>
        <span class="s1">mAllDatum = mRepository.getAllDatum()</span><span class="s0">;</span>
        <span class="s1">mWorkManager = WorkManager.getInstance(application)</span><span class="s0">;</span>
        <span class="s1">sharedPref = PreferenceManager</span>
                <span class="s1">.getDefaultSharedPreferences(getApplication().getApplicationContext())</span><span class="s0">;</span>
        <span class="s1">lat = sharedPref.getString(</span><span class="s3">&quot;lat&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">lon = sharedPref.getString(</span><span class="s3">&quot;lon&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">includeElectronicGenreInd = sharedPref.getBoolean(</span><span class="s3">&quot;include_electronic_shows&quot;</span><span class="s0">, true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">livestreamInd = sharedPref.getBoolean(</span><span class="s3">&quot;livestreams_only&quot;</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">includeOtherGenreInd = sharedPref.getBoolean(</span><span class="s3">&quot;include_other_genres&quot;</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">state = sharedPref.getString(</span><span class="s3">&quot;state&quot;</span><span class="s0">, </span><span class="s3">&quot;California&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">city = sharedPref.getString(</span><span class="s3">&quot;city&quot;</span><span class="s0">, </span><span class="s3">&quot;Los Angeles&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">startDate = sharedPref.getString(</span><span class="s3">&quot;startDate&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">endDate = sharedPref.getString(</span><span class="s3">&quot;endDate&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">festivalInd = sharedPref.getBoolean(</span><span class="s3">&quot;festivals_only&quot;</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span>

    <span class="s1">}</span>
    <span class="s0">private final </span><span class="s1">RaveLocatorRepository mRepository</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">LiveData&lt;List&lt;Datum&gt;&gt; mAllDatum</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">Datum getCoordinates(</span><span class="s0">int </span><span class="s1">eventId){</span>
        <span class="s0">return </span><span class="s1">mRepository.getDatum(eventId)</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">private </span><span class="s1">LiveData&lt;List&lt;Datum&gt;&gt; searchQuery</span><span class="s0">;</span>
    <span class="s1">LiveData&lt;List&lt;Datum&gt;&gt; getAllDatum(){</span>
        <span class="s0">return </span><span class="s1">mAllDatum</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s1">MutableLiveData&lt;RaveLocatorModel&gt; getNearbyEventList(){ </span><span class="s0">return </span><span class="s1">nearbyEventsList</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">insertDatum(Datum datum){ </span><span class="s4">//not used in main activity</span>
        <span class="s1">mRepository.insertDatum(datum)</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">insertVenue(Venue venue) { mRepository.insertVenue(venue)</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">insertDatumVenueCrossRef(DatumVenueCrossRef crossRef){mRepository.insertDatumVenueCrossRef(crossRef)</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s1">DatumWithVenue getVenueOfDatum(</span><span class="s0">int </span><span class="s1">id) {</span><span class="s0">return </span><span class="s1">mRepository.getVenueOfDatum(id)</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s1">List&lt;VenueWithDatum&gt; getDatumOfVenue(String venueName){</span><span class="s0">return </span><span class="s1">mRepository.getDatumOfVenue(venueName)</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">updateDatumFavorites(DatumFavoriteUpdate isFavorite){mRepository.updateDatumFavorites(isFavorite)</span><span class="s0">;</span><span class="s1">}</span>
    <span class="s0">public </span><span class="s1">LiveData&lt;List&lt;Datum&gt;&gt; getAllFavorites(){</span><span class="s0">return </span><span class="s1">mRepository.getAllFavorites()</span><span class="s0">; </span><span class="s1">}</span>
    <span class="s0">public </span><span class="s1">List&lt;Datum&gt; search(String query){</span>
        <span class="s0">return </span><span class="s1">mRepository.search(query)</span><span class="s0">; </span><span class="s1">}</span>

    <span class="s0">public </span><span class="s1">MutableLiveData&lt;RaveLocatorModel&gt; getNearbyEvents() {</span>
        <span class="s1">locationId = sharedPref.getInt(</span><span class="s3">&quot;locationId&quot;</span><span class="s0">, </span><span class="s2">73</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">boolean </span><span class="s1">justAdded = sharedPref.getBoolean(</span><span class="s3">&quot;just_added&quot;</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">if</span><span class="s1">(justAdded){</span>
            <span class="s1">Date todayDate = Calendar.getInstance().getTime()</span><span class="s0">;</span>
            <span class="s0">final </span><span class="s1">SimpleDateFormat formatter = </span><span class="s0">new </span><span class="s1">SimpleDateFormat(</span><span class="s3">&quot;yyyy-MM-dd&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">today = formatter.format(todayDate)</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">today = </span><span class="s3">&quot;&quot;</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s4">//Toast.makeText(getApplication().getApplicationContext(),lon, Toast.LENGTH_LONG);</span>
        <span class="s0">final </span><span class="s1">MutableLiveData&lt;RaveLocatorModel&gt; mutableLiveData = </span><span class="s0">new </span><span class="s1">MutableLiveData&lt;&gt;()</span><span class="s0">;</span>
        <span class="s1">Retrofit retrofit = </span><span class="s0">new </span><span class="s1">Retrofit.Builder()</span>
                <span class="s1">.baseUrl(</span><span class="s3">&quot;https://edmtrain.com&quot;</span><span class="s1">)</span>
                <span class="s1">.callbackExecutor(Executors.newSingleThreadExecutor())</span>
                <span class="s1">.addConverterFactory(JacksonConverterFactory.create())</span>
                <span class="s1">.build()</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">RaveLocatorService service = retrofit.create(RaveLocatorService.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">Call&lt;RaveLocatorModel&gt; callRequest = service.getRaveLocations(festivalInd</span><span class="s0">,</span><span class="s1">today</span><span class="s0">, </span><span class="s1">today</span><span class="s0">, </span><span class="s1">startDate</span><span class="s0">, </span><span class="s1">endDate</span><span class="s0">, </span><span class="s1">locationId</span><span class="s0">, </span><span class="s1">includeElectronicGenreInd</span><span class="s0">,</span><span class="s1">livestreamInd</span><span class="s0">,</span><span class="s1">includeOtherGenreInd</span><span class="s0">,</span><span class="s3">&quot;cc037aec-dde2-4060-98d9-0d121af42c73&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">callRequest.enqueue(</span><span class="s0">new </span><span class="s1">Callback&lt;RaveLocatorModel&gt;() {</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onResponse(Call&lt;RaveLocatorModel&gt; call</span><span class="s0">, </span><span class="s1">Response&lt;RaveLocatorModel&gt; response) {</span>
                <span class="s1">mutableLiveData.postValue(response.body())</span><span class="s0">;</span>
                <span class="s1">Log.e(</span><span class="s3">&quot;BACON AND&quot;</span><span class="s0">, </span><span class="s1">mutableLiveData.toString())</span><span class="s0">;</span>

            <span class="s1">}</span>

            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onFailure(Call&lt;RaveLocatorModel&gt; call</span><span class="s0">, </span><span class="s1">Throwable t) {</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;NO&quot;</span><span class="s0">, </span><span class="s1">t.getMessage())</span><span class="s0">;</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;YES&quot;</span><span class="s0">, </span><span class="s1">call.toString())</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>
        <span class="s1">nearbyEventsList = mutableLiveData</span><span class="s0">;</span>
        <span class="s0">return </span><span class="s1">mutableLiveData</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">getLocationId() {</span>
        <span class="s4">//Toast.makeText(getApplication().getApplicationContext(),lon, Toast.LENGTH_LONG);</span>
        <span class="s1">Retrofit retrofit = </span><span class="s0">new </span><span class="s1">Retrofit.Builder()</span>
                <span class="s1">.baseUrl(</span><span class="s3">&quot;https://edmtrain.com&quot;</span><span class="s1">)</span>
                <span class="s1">.callbackExecutor(Executors.newSingleThreadExecutor())</span>
                <span class="s1">.addConverterFactory(JacksonConverterFactory.create())</span>
                <span class="s1">.build()</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">RaveLocatorService service = retrofit.create(RaveLocatorService.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">Call&lt;LocationDataModel&gt; callRequest</span><span class="s0">;</span>
        <span class="s1">callRequest = service.getLocationId(state</span><span class="s0">, </span><span class="s1">city</span><span class="s0">, </span><span class="s3">&quot;cc037aec-dde2-4060-98d9-0d121af42c73&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">callRequest.enqueue(</span><span class="s0">new </span><span class="s1">Callback&lt;LocationDataModel&gt;() {</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onResponse(Call&lt;LocationDataModel&gt; call</span><span class="s0">, </span><span class="s1">Response&lt;LocationDataModel&gt; response) {</span>
                <span class="s1">SharedPreferences.Editor editor = sharedPref.edit()</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(response.body().getSuccess() == </span><span class="s0">false</span><span class="s1">) {</span>
                    <span class="s1">getStateWideLocationId()</span><span class="s0">;</span>
                    <span class="s0">return;</span>
                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s1">editor.putInt(</span><span class="s3">&quot;locationId&quot;</span><span class="s0">, </span><span class="s1">response.body().getData().get(</span><span class="s2">0</span><span class="s1">).getId())</span><span class="s0">;</span>
                    <span class="s1">editor.apply()</span><span class="s0">;</span>
                    <span class="s1">Log.d(</span><span class="s3">&quot;GOT LOCATION&quot;</span><span class="s0">, </span><span class="s1">response.body().getData().get(</span><span class="s2">0</span><span class="s1">).getState())</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>

            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onFailure(Call&lt;LocationDataModel&gt; call</span><span class="s0">, </span><span class="s1">Throwable t) {</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;Get Location Failed&quot;</span><span class="s0">, </span><span class="s1">t.getMessage())</span><span class="s0">;</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;Get Location Failed&quot;</span><span class="s0">, </span><span class="s1">call.toString())</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">getStateWideLocationId() {</span>

        <span class="s4">//Toast.makeText(getApplication().getApplicationContext(),lon, Toast.LENGTH_LONG);</span>
        <span class="s1">Retrofit retrofit = </span><span class="s0">new </span><span class="s1">Retrofit.Builder()</span>
                <span class="s1">.baseUrl(</span><span class="s3">&quot;https://edmtrain.com&quot;</span><span class="s1">)</span>
                <span class="s1">.callbackExecutor(Executors.newSingleThreadExecutor())</span>
                <span class="s1">.addConverterFactory(JacksonConverterFactory.create())</span>
                <span class="s1">.build()</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">RaveLocatorService service = retrofit.create(RaveLocatorService.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">final </span><span class="s1">Call&lt;LocationDataModel&gt; callRequest</span><span class="s0">;</span>
        <span class="s1">callRequest = service.getLocationId(state</span><span class="s0">,  </span><span class="s3">&quot;cc037aec-dde2-4060-98d9-0d121af42c73&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">callRequest.enqueue(</span><span class="s0">new </span><span class="s1">Callback&lt;LocationDataModel&gt;() {</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onResponse(Call&lt;LocationDataModel&gt; call</span><span class="s0">, </span><span class="s1">Response&lt;LocationDataModel&gt; response) {</span>
                <span class="s1">SharedPreferences.Editor editor = sharedPref.edit()</span><span class="s0">;</span>
                <span class="s1">editor.putInt(</span><span class="s3">&quot;locationId&quot;</span><span class="s0">, </span><span class="s1">response.body().getData().get(</span><span class="s2">0</span><span class="s1">).getId())</span><span class="s0">;</span>
                <span class="s1">editor.apply()</span><span class="s0">;</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;GOT LOCATION&quot;</span><span class="s0">, </span><span class="s1">response.body().getData().get(</span><span class="s2">0</span><span class="s1">).getState())</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onFailure(Call&lt;LocationDataModel&gt; call</span><span class="s0">, </span><span class="s1">Throwable t) {</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;Get Location Failed&quot;</span><span class="s0">, </span><span class="s1">t.getMessage())</span><span class="s0">;</span>
                <span class="s1">Log.d(</span><span class="s3">&quot;Get Location Failed&quot;</span><span class="s0">, </span><span class="s1">call.toString())</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>
    <span class="s1">}</span>





    <span class="s0">void </span><span class="s1">updateDatabase(){</span>
        <span class="s0">if</span><span class="s1">(mAllDatum == </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">mWorkManager.enqueue(OneTimeWorkRequest.from(UpdateDatabaseWorker.</span><span class="s0">class</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">PeriodicWorkRequest updateDatabase = </span><span class="s0">new </span><span class="s1">PeriodicWorkRequest.Builder(UpdateDatabaseWorker.</span><span class="s0">class, </span><span class="s2">24</span><span class="s0">, </span><span class="s1">TimeUnit.HOURS)</span>
                    <span class="s1">.build()</span><span class="s0">;</span>
            <span class="s1">mWorkManager.enqueue(updateDatabase)</span><span class="s0">;</span>
            <span class="s1">Toast.makeText(getApplication()</span><span class="s0">, </span><span class="s3">&quot;Updating Database&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT).show()</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>




<span class="s1">}</span>

</pre>
</body>
</html>